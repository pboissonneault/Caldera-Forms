function new_conditional_group(c){var e=c.trigger.data("id"),d="cl"+Math.round(Math.random()*18746582734),a="rw"+Math.round(Math.random()*98347598345),b=[{id:a,type:c.trigger.data("type"),lines:[{id:d}]}];return{group:b,id:e}}function new_conditional_line(d){var f=d.trigger.data("id"),c=d.trigger.data("group"),b=d.trigger.data("type"),e="cl"+Math.round(Math.random()*18746582734),a={id:f,type:b,lineid:e,rowid:c,name:"config["+b+"]["+f+"][conditions][group]["+c+"]["+e+"]"};return a}function build_conditions_config(b){var a=JSON.parse(b.trigger.val());a.id=b.trigger.data("id");return a}jQuery(document).ready(function(f){f(".caldera-header-save-button").baldrick({method:"POST",request:"admin.php?page=caldera-forms",before:function(h,i){i.preventDefault();if(!check_required_bindings()){return false}f("#save_indicator").addClass("loading");if(typeof tinyMCE!=="undefined"){tinyMCE.triggerSave()}var g=f(".caldera-forms-options-form").formJSON();if(g.conditions){g.config.conditional_groups={conditions:g.conditions}}f(h).data("cf_edit_nonce",g.cf_edit_nonce);f(h).data("_wp_http_referer",g._wp_http_referer);f(h).data("sender","ajax");f(h).data("config",JSON.stringify(g.config));return true},callback:function(h){if(false===h.data){var g=f(".updated_notice_box");g.stop().animate({top:0},200,function(){setTimeout(function(){g.stop().animate({top:-75},200)},2000)})}},complete:function(g){f(".wrapper-instance-pane .field-config").prop("disabled",false)}});function e(g){var m=f(g),n=m.closest(".caldera-editor-field-config-wrapper"),k=n.find(".caldera-config-field-setup"),o=(compiled_templates[m.val()+"_tmpl"]?compiled_templates[m.val()+"_tmpl"]:compiled_templates.noconfig_field_templ),h=n.find(".field_config_string").val(),l=m.data("type");fn=window[m.val()+"_caldera_setup"];n.find(".caldera-config-group").show();m.addClass("field-initialized");if(h.length&&l===m.val()){h=JSON.parse(h)}else{h=fieldtype_defaults[m.val()+"_cfg"]}if(!h){h={}}h._id=m.data("field");h._name="config[fields]["+m.data("field")+"][config]";o=f("<div>").html(o(h));k.html(o.html());if(typeof window[m.val()+"_init"]==="function"){window[m.val()+"_init"](m.data("field"),k)}if(fieldtype_defaults[m.val()+"_nosupport"]){if(fieldtype_defaults[m.val()+"_nosupport"].indexOf("hide_label")>=0){n.find(".hide-label-field").hide().find(".field-config").prop("checked",false)}if(fieldtype_defaults[m.val()+"_nosupport"].indexOf("caption")>=0){n.find(".caption-field").hide().find(".field-config").val("")}if(fieldtype_defaults[m.val()+"_nosupport"].indexOf("required")>=0){n.find(".required-field").hide().find(".field-config").prop("checked",false)}if(fieldtype_defaults[m.val()+"_nosupport"].indexOf("custom_class")>=0){n.find(".customclass-field").hide().find(".field-config").val("")}if(fieldtype_defaults[m.val()+"_nosupport"].indexOf("entry_list")>=0){n.find(".entrylist-field").hide().find(".field-config").prop("checked",false)}}n.find(".toggle_show_values").trigger("change");if(!f(".caldera-select-field-type").not(".field-initialized").length){if(!core_form.hasClass("builder-loaded")){var i=f(".caldera-select-field-type.field-initialized");for(var j=0;j<i.length;j++){a(f(i[j]).data("field"))}core_form.addClass("builder-loaded")}else{a(m.data("field"))}f(".caldera-header-save-button").prop("disabled",false);rebuild_field_binding();baldrickTriggers()}if(typeof fn==="function"){fn(n.attr("id"))}}function a(h){var g=f("#"+h),n=g.find(".caldera-select-field-type"),m=f('.layout-form-field[data-config="'+h+'"]'),j=m.find(".field_preview"),l=f("#preview-"+n.val()+"_tmpl").html(),o=compiled_templates["preview-"+n.val()+"_tmpl"],i={id:h},k=g.find(".field-config"),p=[];k.each(function(t,z){var x=f(z),w=x.prop("name").split("["+h+"]")[1].substr(1),q=w.substr(0,w.length-1).split("]["),y=(x.is(":checkbox,:radio")?x.filter(":checked").val():x.val()),r={};for(var u=q.length-1;u>=0;u--){if(u===q.length-1){r[q[u]]=y}else{var s=r;r={};r[q[u]]=s}}f.extend(true,i,r)});j.html(o(i));m.removeClass("button");f(".preview-field-config").prop("disabled",true)}function c(r){var h=f(".caldera-editor-fields-panel"),w=f(".caldera-editor-groups-panel"),y=f(".caldera-group-nav"),s=f('[data-group="'+r+'"]'),l=s.find(".caldera-config-group-name"),u=s.find(".caldera-config-group-slug"),g=s.find(".caldera-config-group-desc"),i=s.find(".caldera-config-group-admin"),v=f(".active-group-name"),n=f(".active-group-slug"),m=f(".active-group-desc"),x=f(".active-group-admin"),j=f(".caldera-editor-fields-list ul"),p=s.find(".caldera-config-group-repeat"),o=f(".repeat-config-button"),t=f(".caldera-editor-group-settings"),k=f(".caldera-config-group-remove"),q;f(".new-group-input").remove();f(".new-field-input").remove();y.removeClass("active");h.show();j.hide();j.removeClass("active").find("li.active").removeClass("active");j.hide();s.addClass("active");q=f(".caldera-editor-fields-list ul.active li");if(q.length){k.hide()}else{k.show()}f(".caldera-editor-field-config-wrapper").hide();s.show();v.val(l.val());n.val(u.val());m.val(g.val());if(i.val()==="1"){x.prop("checked",true)}else{x.prop("checked",false)}if(p.val()==="1"){o.addClass("field-edit-open")}else{o.removeClass("field-edit-open")}}f("body").on("click",".toggle_processor_event input",function(k){var g=f(this),i=g.closest(".wrapper-instance-pane"),h=i.find(".caldera-config-processor-setup"),j=i.find(".caldera-config-processor-notice");if(g.is(":checked")){g.parent().addClass("button-primary")}else{g.parent().removeClass("button-primary")}if(i.find(".toggle_processor_event .button-primary").length){h.slideDown(100);j.slideUp(100)}else{h.slideUp(100);j.slideDown(100)}});f("body").on("click",".toggle_option_tab > a",function(k){k.preventDefault();var j=f(this),g=f(j.attr("href")),i=j.parent().find("a"),h=j.closest(".caldera-editor-config-wrapper").find(".wrapper-instance-pane");i.removeClass("button-primary");h.hide();g.show();j.addClass("button-primary");f(".caldera-conditionals-usetype").trigger("change")});f(".caldera-editor-body").on("change",".caldera-select-field-type",function(g){e(this)});f(".caldera-editor-body").on("click",".caldera-group-nav a",function(g){g.preventDefault();c(f(this).attr("href").substr(1))});f(".caldera-editor-body").on("click",".caldera-editor-fields-list a",function(h){h.preventDefault();var g=f(this),i=f(g.attr("href"));f(".new-group-input").remove();f(".new-field-input").remove();f(".caldera-editor-fields-list li.active").removeClass("active");g.parent().addClass("active");f(".caldera-editor-field-config-wrapper").hide();i.show()});f(".caldera-editor-body").on("click",".group-config-button",function(k){var h=f(this),g=f(".caldera-editor-group-settings"),i=h.closest(".caldera-editor-fields-panel"),j=f(".caldera-config-group-remove");if(i.find(".caldera-field-line").length){j.hide()}else{j.show()}if(h.hasClass("field-edit-open")){g.slideUp(100);h.removeClass("field-edit-open")}else{g.slideDown(100);h.addClass("field-edit-open")}});f(".caldera-editor-body").on("keydown",".field-config",function(g){if(f(this).is("textarea")){return}if(g.which===13){g.preventDefault()}});f(".caldera-editor-body").on("change",".field-label",function(h){var g=f(this).closest(".caldera-editor-field-config-wrapper").prop("id");field_line=f('[data-field="'+g+'"]'),field_title=f("#"+g+" .caldera-editor-field-title, .layout-form-field.field-edit-open .layout_field_name"),slug=f("#"+g+" .field-slug");field_line.find("a").html('<i class="icn-field"></i> '+this.value);field_title.text(this.value);if(h.type==="change"){slug.trigger("change")}rebuild_field_binding()});f(".caldera-editor-body").on("change",".active-group-name",function(j){j.preventDefault();var h=f(".caldera-group-nav.active"),i=h.data("group"),k=h.find(".caldera-config-group-name"),g=h.find("span");if(j.type==="focusout"&&!this.value.length){this.value="Group "+(parseInt(h.index())+1)}k.val(this.value);g.text(this.value)});f(".caldera-editor-body").on("change",".active-group-slug",function(k){k.preventDefault();var i=f(".caldera-group-nav.active"),j=i.data("group"),m=i.find(".caldera-config-group-name").val(),l=i.find(".caldera-config-group-slug"),h=i.find("span"),g=this.value.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase();if(k.type==="focusout"&&!this.value.length){g=m.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase()}l.val(g);this.value=g});f(".caldera-editor-body").on("change",".active-group-desc",function(j){j.preventDefault();var h=f(".caldera-group-nav.active"),i=h.data("group"),g=h.find(".caldera-config-group-desc");g.val(this.value)});f(".caldera-editor-body").on("change",".active-group-admin",function(l){l.preventDefault();var j=f(".caldera-group-nav.active"),k=j.data("group"),m=j.find(".caldera-config-group-name").val(),g=j.find(".caldera-config-group-admin"),i=j.find("span"),h=this.value.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase();if(f(this).prop("checked")){g.val(1);j.addClass("is-admin")}else{g.val(0);j.removeClass("is-admin")}});f(".caldera-editor-body").on("click",".repeat-config-button",function(l){l.preventDefault();var j=f(".caldera-group-nav.active"),k=j.data("group"),i=j.find("a .group-type"),g=j.find(".caldera-config-group-repeat"),h=f(this);if(h.hasClass("field-edit-open")){g.val("0");i.removeClass("icn-repeat").addClass("icn-folder");h.removeClass("field-edit-open")}else{g.val("1");i.addClass("icn-repeat").removeClass("icn-folder");h.addClass("field-edit-open")}});f(".caldera-editor-body").on("click",".delete-field",function(){var g=f(this),h=g.closest(".caldera-editor-field-config-wrapper").prop("id");if(!confirm(g.data("confirm"))){return}f("#"+h).remove();f('option[value="'+h+'"]').remove();f('[data-bind="'+h+'"]').remove();delete current_form_fields[h];f('[data-config="'+h+'"]').slideUp(200,function(){var i=f(this);i.remove();rebuild_field_binding();f(document).trigger("field.removed")})});f(".caldera-editor-body").on("click",".add-new-group,.add-field",function(){var i=f(this);f(".new-group-input").remove();f(".new-field-input").remove();if(i.hasClass("add-field")){var g=f('<input type="text" class="new-field-input block-input">');g.appendTo(f(".caldera-editor-fields-list ul.active")).focus()}else{var h=f('<input type="text" class="new-group-input block-input">');h.appendTo(f(".caldera-editor-groups-panel")).focus()}});f(".caldera-editor-body").on("change keypress",".new-group-input",function(l){if(l.type==="keypress"){if(l.which===13){l.preventDefault()}else{return}}var n=this.value,h=f(this),k=f(".caldera-editor-groups-panel ul"),m=f(".caldera-editor-fields-list"),i,j;if(!n.length){h.remove()}else{i=Handlebars.compile(f("#caldera_group_line_templ").html());j={id:n.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase(),name:n,};k.append(i(j));var g=f('<ul data-group="'+j.id+'">').hide();g.appendTo(m);h.remove();c(j.id)}});f(".caldera-editor-body").on("change keypress",".new-field-input",function(j){if(j.type==="keypress"){if(j.which===13){j.preventDefault()}else{return}}var h=this.value,n=f(this),g=n.parent(),p=f(".caldera-editor-field-config"),l,k,o,i=f(".caldera-config-group-remove");if(!h.length){n.remove()}else{i.hide();l=Handlebars.compile(f("#caldera_field_line_templ").html());k=Handlebars.compile(f("#caldera_field_config_wrapper_templ").html());o={id:h.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase(),label:h,slug:h.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase(),group:f(".caldera-group-nav.active").data("group")};var m=f(l(o));m.appendTo(g);p.append(k(o));m.find("a").trigger("click");n.remove()}});f(".caldera-editor-body").on("change",".field-slug",function(g){if(this.value.length){this.value=this.value.split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase()}else{if(g.type==="change"){this.value=f(this).closest(".caldera-editor-field-config-wrapper").find(".field-label").val().split(" ").join("_").split("-").join("_").replace(/[^a-z0-9_]/gi,"").toLowerCase()}}});f(".caldera-editor-body").on("click",".caldera-add-group",function(j){var g=f(this),i=g.data("group"),h=f("#"+i+"_panel_tmpl").html();g.parent().parent().append(h)});f(".caldera-editor-body").on("click",".caldera-config-group-remove",function(h){var g=f(".active-group-slug").val();f('[data-group="'+g+'"]').hide(0,function(){f(this).remove();var i=f(".caldera-group-nav");if(i.length){i.first().find("a").trigger("click")}else{f(".caldera-editor-fields-panel").hide()}})});f("body").on("click",".set-current-field",function(h){h.preventDefault();var g=f(this);f("#"+g.data("field")+"_type").val(g.data("type")).trigger("change");f("#"+g.data("field")+"_lable").focus();f("#field_setup_baldrickModalCloser").trigger("click")});f(".caldera-editor-body").on("change",".field-config",function(i){var h=f(this),g=h.closest(".caldera-editor-field-config-wrapper");if(!current_form_fields){return}if(h.prop("id")===g.prop("id")+"_lable"){current_form_fields[g.prop("id")].label=this.value}if(h.prop("id")===g.prop("id")+"_slug"){current_form_fields[g.prop("id")].slug=this.value}if(h.prop("id")===g.prop("id")+"_type"){current_form_fields[g.prop("id")].type=this.value}if(g.length){a(g.prop("id"))}});f(".caldera-editor-body").on("focus",".caldera-field-bind",function(i){var h=f(this),g=this.value;if(i.type&&i.type==="focusin"){h.removeClass("bound_field").addClass("reload-binding");rebind_field_bindings();this.value=g;return}});f(".caldera-editor-body").on("change",".caldera-conditional-field-set",function(n){var s=f(this),l=s.parent().find(".compare-type"),q=s.data("condition"),m=s.data("id"),h="config["+q+"]["+m+"][conditions][group]["+s.data("row")+"]["+s.data("line")+"]",k=s.data("line"),o=f("#"+k+"_value"),p=o.find(".caldera-conditional-value-field").first(),i,r,g=[];var u=this.value;if(u.substr(0,1)!=="{"){i=f("#"+u);r=i.find(".field-button-type");g=i.find(".caldera-config-group-toggle-options")}if(s.hasClass(".bind_init")){s.addClass("bound_triggered")}if(p.length){if(p.val().length){o.data("value",p.val())}}l.show();if(g.length){var t=g.find(".toggle_option_row"),j='<select name="'+h+'[value]" class="caldera-processor-value-bind caldera-conditional-value-field" data-field="'+u+'" style="max-width: 220px; width: 220px;">';j+='<option value=""></option>';t.each(function(x,w){var y=f(w).find(".toggle_label_field"),A=y.data("option"),z="";if(o.data("value")){if(o.data("value").toString()===A||o.data("value").toString()===f(w).find(".toggle_value_field").val()){z=' selected="selected"'}}j+='<option value="'+A+'"'+z+">"+y.val()+"</option>"});j+="</select>"}else{if(r&&r.val()=="button"){l.val("is").hide();j='<select name="'+h+'[value]" class="caldera-processor-value-bind caldera-conditional-value-field" data-field="'+u+'" style="max-width: 220px; width: 220px;">';j+='<option value="click" '+(o.data("value")==="click"?'selected="selected"':"")+">Click</option>";j+='<option value="dblclick" '+(o.data("value")==="dblclick"?'selected="selected"':"")+">Double Click</option>";j+="</select>"}else{j='<input name="'+h+'[value]" type="text" class="caldera-conditional-value-field magic-tag-enabled" value="'+(o.data("value")?o.data("value"):"")+'" style="max-width: 205px;">'}}o.html(j);init_magic_tags()});f(".caldera-editor-body").on("change",".caldera-conditionals-usetype",function(h){var g=f(this);if(this.value==="show"||this.value==="hide"||this.value==="disable"||this.value==="use"||this.value==="not"){f("#"+g.data("id")+"_condition_group_add").show();f("#"+g.data("id")+"_conditional_wrap").show()}else{f("#"+g.data("id")+"_condition_group_add").hide();f("#"+g.data("id")+"_conditional_wrap").hide()}});f(".caldera-editor-body").on("click",".remove-conditional-line",function(j){j.preventDefault();var h=f(this),g=h.closest(".caldera-condition-line"),i=h.closest(".caldera-condition-group");g.remove();if(!i.find(".caldera-condition-line").length){i.remove()}});f(".caldera-group-nav").first().find("a").trigger("click");f(".caldera-editor-body").on("change",".toggle_show_values",function(i){var g=f(this),h=g.closest(".caldera-config-group-toggle-options");values=h.find(".toggle_value_field"),lables=h.find(".toggle_label_field"),field_lables=h.find(".caldera-config-group-option-labels");if(!g.prop("checked")){values.hide().parent().hide();lables.css("width",245);field_lables.hide()}else{values.show().parent().show();values.show().parent().parent().show();lables.css("width","");field_lables.show()}lables.trigger("toggle.values");init_magic_tags()});f(".caldera-editor-body").on("change",".auto-populate-type",function(){f(this).closest(".wrapper-instance-pane").find(".auto-populate-options").trigger("change")});f(".caldera-editor-body").on("change",".auto-populate-options",function(){var j=f(this),k=j.closest(".wrapper-instance-pane"),i=k.find(".caldera-config-group-toggle-options"),g=k.find(".caldera-config-group-auto-options"),h=g.find(".auto-populate-type");g.find(".auto-populate-type-panel").hide();if(j.prop("checked")){i.hide();g.show()}else{i.show();g.hide()}g.find(".caldera-config-group-auto-"+h.val()).show()});f("body").on("change",".pin-toggle-roles",function(){var g=f(this),h=f("#caldera-pin-rules");if(g.val()==="1"){h.show()}else{h.hide()}});f("body").on("click",".magic-tag-init",function(i){var h=f(this),g=h.prev();g.focus().trigger("init.magic")});f("body").on("keyup blur focus select click init.magic",".magic-tag-enabled",function(E){init_magic_tags();var u=f(this),s=u.parent(),j=(s.closest(".wrapper-instance-pane").find(".caldera-select-field-type").val()?s.closest(".wrapper-instance-pane").find(".caldera-select-field-type").val():"hidden"),w=s.find(".magic-tags-autocomplete"),D=w.find("ul"),n=this.value,I=[],H=[],r="",m=this.selectionStart,k=this.selectionEnd;if(w.length&&w.data("focus")){E.preventDefault();return}u.data("tag","");if(this.selectionEnd>this.selectionStart){r=this.value.substr(this.selectionStart,(this.selectionEnd-this.selectionStart))}else{if((E.type==="select"||E.type==="keyup")&&(E.which!==40&&E.which!==38&&E.which!==39&&E.which!==37)){for(m=this.selectionStart;m>0;m--){var v=n.substr(m-1,1);if(v===" "||v==="\n"||((v==="%"||v==="}")&&this.selectionStart===m)){break}}for(k=this.selectionStart;k<n.length;k++){var v=n.substr(k,1);if(v===" "||v==="\n"||((v==="%"||v==="{")&&this.selectionStart===k)){break}}r=n.substr(m,(k-m))}}if(E.type!=="focusout"){if(E.type!=="init"&&r.length<3){if(w.length){w.remove()}return}if(!w.length){w=f('<div class="magic-tags-autocomplete"></div>');D=f("<ul></ul>");D.appendTo(w);w.insertAfter(u);w.on("mouseenter",function(){f(this).data("focus",true)});w.on("mouseleave",function(){f(this).data("focus",false);if(!u.is(":focus")){u.trigger("focusout")}})}D.empty();var A="system";var B=false;if(j==="hidden"||j==="dropdown"||j==="radio"||j==="toggle_switch"||j==="checkbox"){B=true;j="text";A="all"}else{if(j==="paragraph"||j==="html"){j="text"}}if(u.data("type")){j=u.data("type")}j=j.split(",");j.push("vars");for(var o=0;o<j.length;o++){for(var h in system_values){if(typeof system_values[h].tags[j[o]]==="undefined"){continue}H=[h];if(h!=="system"&&h!=="variable"&&h!=="field"){var C=jQuery(".processor-"+h),q=u.closest(".caldera-editor-processor-config-wrapper"),t=q.prop("id");H=[];for(var G=0;G<C.length;G++){if(!q.length&&B===true){H.push(C[G].id)}else{if(t===C[G].id){continue}if(jQuery("li."+C[G].id).index()<jQuery("li."+t).index()){H.push(C[G].id)}}}}for(var F=0;F<H.length;F++){if(A==="all"||A===h||h==="variable"){var l=f('<li class="header">'+system_values[h].type+(F>0?" ["+(F+1)+"]":"")+"</li>"),g=0;l.appendTo(D);for(var z=0;z<system_values[h].tags[j[o]].length;z++){if(u.data("parent")){if("variable:"+u.data("parent")===system_values[h].tags[j[o]][z]){continue}}var y=system_values[h].wrap[0]+system_values[h].tags[j[o]][z]+system_values[h].wrap[1];if(H[F]!==h&&H.length>1){y=system_values[h].wrap[0]+system_values[h].tags[j[o]][z]+":"+H[F]+system_values[h].wrap[1]}if(y.indexOf(r)>=0||E.type==="init"){g+=1;var x=y.replace(r,"<strong>"+r+"</strong>");var p=f('<li class="tag" data-tag="'+y+'">'+x+"</li>");p.on("click",function(){var i=f(this).data("tag");u.val(n.substr(0,m)+i+n.substr(k)).trigger("change").focus();u[0].selectionStart=m+i.length-(i.indexOf("*")>0?2:0);u[0].selectionEnd=m+i.length-(i.indexOf("*")>0?1:0);k=m=u[0].selectionEnd;n+=i;u.trigger("init.magic")});p.appendTo(D)}}if(g===0){l.remove()}}}}}}if(!D.children().length){w.remove()}if(E.type==="focusout"){setTimeout(function(){w.remove()},200)}});var d=f(".cf-editor-template");for(var b=0;b<d.length;b++){compiled_templates[d[b].id]=Handlebars.compile(d[b].innerHTML)}f(".caldera-select-field-type").not(".field-initialized").each(function(h,g){e(g)})});var rebuild_field_binding,rebind_field_bindings,current_form_fields={},required_errors={},add_new_grid_page,add_page_grid,init_magic_tags,core_form,compiled_templates={};init_magic_tags=function(){var a=jQuery(".magic-tag-enabled");a.each(function(f,e){var d=jQuery(e);if(d.hasClass("magic-tag-init-bound")){var c=d.parent().find(".magic-tag-init");if(!d.is(":visible")){c.hide()}else{c.show()}return}else{var b=jQuery('<span class="icn-code magic-tag-init"></span>'),g=jQuery('<span style="position:relative;display:inline-block; width:100%;"></span>');if(d.is("input")){b.css("borderBottom","none")}if(d.hasClass("caldera-conditional-value-field")){g.width("auto")}d.wrap(g);b.insertAfter(d);d.addClass("magic-tag-init-bound");if(!d.is(":visible")){b.hide()}else{b.show()}}})};rebuild_field_binding=function(){if(!core_form){core_form=jQuery(".caldera-forms-options-form")}if(!core_form.hasClass("builder-loaded")){return}var a=jQuery(".caldera-editor-field-config-wrapper");system_values.field={tags:{text:[]},type:"Fields",wrap:["%","%"]};for(var g=0;g<a.length;g++){var e=a[g].id,c=jQuery("#"+e+"_lable").val(),b=jQuery("#"+e+"_slug").val(),d=jQuery("#"+e+"_type").val();if(typeof system_values.field.tags[d]==="undefined"){system_values.field.tags[d]=[]}system_values.field.tags[d].push(b);if(d!=="text"){system_values.field.tags.text.push(b)}current_form_fields[e]={label:c,slug:b,type:d};jQuery("option.bound-field").trigger("change").each(function(h,f){var i=jQuery(f);if(i.prop("value").indexOf("{")!==0){i.text(jQuery("#"+i.prop("value")+"_lable").val()+" ["+jQuery("#"+i.prop("value")+"_lable").val()+"]")}else{i.text(i.prop("value").replace("{","").replace("}",""))}}).removeClass("bound-field")}};rebind_field_bindings=function(){var z=jQuery(".caldera-field-bind").not(".bound_field"),y,s;if(!z.length){return}z.addClass("bound_field");for(var m=0;m<z.length;m++){var b=jQuery(z[m]),p=b.val(),q=b.data("default"),d=b.data("exclude"),g=0,f=b.closest(".caldera-editor-processor-config-wrapper"),k=f.prop("id"),o="";if(q&&!b.hasClass("reload-binding")){p=q}if(b.is("select")){b.empty();var j=jQuery('<optgroup label="Fields">');for(var a in current_form_fields){if(b.data("type")){if(b.data("type").split(",").indexOf(current_form_fields[a].type)<0){continue}}if(b.data("id")!==a){j.append('<option value="'+a+'"'+(p===a?'selected="selected"':"")+">"+current_form_fields[a].label+" ["+current_form_fields[a].slug+"]</option>")}g+=1}j.appendTo(b);if(g===0){b.empty()}for(var e in system_values){y=[];if(d){if(d.split(",").indexOf(e)>=0){continue}}if(e!=="system"&&e!=="variable"){var u=jQuery(".processor-"+e);for(var x=0;x<u.length;x++){if(k===u[x].id){continue}y.push(u[x].id);if(u.length>1){if(s=jQuery("li."+u[x].id+" .processor-line-number")){s.html("["+(x+1)+"]")}}}}else{y.push("__system__")}var l=[];if(b.data("type")){l=b.data("type").split(",");l.push("vars")}else{l=["text","vars"]}for(var n=0;n<l.length;n++){if(system_values[e].tags[l[n]]){for(var w=0;w<y.length;w++){if(jQuery("li."+y[w]).index()>jQuery("li."+k).index()&&y[w]!=="__system__"){if(b.closest(".caldera-editor-processors-panel-wrap").length){o=' disabled="disabled"'}}else{o=""}var j=jQuery('<optgroup label="'+system_values[e].type+(y[w]!=="__system__"?" "+(jQuery("li."+y[w]).find(".processor-line-number").html()):"")+'"'+o+">");for(var r=0;r<system_values[e].tags[l[n]].length;r++){var h=system_values[e].tags[l[n]][r];if(y[w]!=="__system__"){h=h.replace(e,y[w])}j.append('<option value="{'+h+'}"'+(p==="{"+h+"}"?'selected="selected"':"")+o+">"+system_values[e].tags[l[n]][r]+"</option>");g+=1}if(j.children().length){j.appendTo(b)}}}}}if(g===0){b.empty();if(b.data("type")){b.append('<option value="">No '+b.data("type").split(",").join(" or ")+" in form</option>");var A=true}}else{b.prop("disabled",false)}if(!b.hasClass("required")&&typeof A==="undefined"){b.prepend('<option value=""></option>')}b.val(p)}else{}}init_magic_tags();jQuery(document).trigger("bound.fields");jQuery(".caldera-header-save-button").prop("disabled",false)};function setup_field_type(a){return{id:a.trigger.prop("id")}}function check_required_bindings(e){var a,g=jQuery(".caldera-header-save-button"),f=jQuery(".layout-form-field"),b=jQuery(".caldera-processor-nav"),d=true;if(e){a=jQuery(e)}else{a=jQuery(".caldera-config-field .required")}a.removeClass("has-error");f.removeClass("has-error");b.removeClass("has-error");jQuery(".error-tag").remove();required_errors={};a.each(function(l,j){var o=jQuery(j),h=o.closest(".caldera-config-editor-panel");if(!j.value.length){if(!required_errors[h.prop("id")]){required_errors[h.prop("id")]=0}var m=o.closest(".caldera-editor-field-config-wrapper"),i=o.closest(".caldera-editor-processor-config-wrapper");if(m.length){jQuery('.layout-form-field[data-config="'+m.prop("id")+'"]').addClass("has-error")}if(i.length){jQuery("."+i.prop("id")).addClass("has-error")}required_errors[h.prop("id")]+=1;o.addClass("has-error");d=false}else{if(o.hasClass("field-slug")){var p=jQuery(".field-slug").not(o);for(var n=0;n<p.length;n++){if(p[n].value===j.value){var o=jQuery(p[n]);if(!required_errors[h.prop("id")]){required_errors[h.prop("id")]=0}var m=o.closest(".caldera-editor-field-config-wrapper"),i=o.closest(".caldera-editor-processor-config-wrapper");if(m.length){jQuery('.layout-form-field[data-config="'+m.prop("id")+'"]').addClass("has-error")}if(i.length){jQuery("."+i.prop("id")).addClass("has-error")}required_errors[h.prop("id")]+=1;o.addClass("has-error");break}}}}});for(var c in required_errors){jQuery(".caldera-forms-options-form").find('a[href="#'+c+'"]').append('<span class="error-tag">'+required_errors[c]+"</span>")}jQuery(".caldera-conditional-field-set").trigger("change");return d}jQuery(document).ready(function(c){add_new_grid_page=function(e){return{page_no:"pg_"+Math.round(Math.random()*10000000)}};add_page_grid=function(g){var e=c(".page-toggle").length+1,f=c('<button type="button" data-name="Page '+e+'" data-page="'+g.rawData.page_no+'" class="page-toggle button">'+g.params.trigger.data("addtitle")+" "+e+"</button> "),h=c("#page-toggles");f.appendTo(h);h.show();b();f.trigger("click");if(e===1){h.hide()}c(document).trigger("add.page")};c(document).on("remove.page add.page load.page",function(h){var f=c(".page-toggle").length,g=c("#tab_pages");if(f<=1){g.hide()}else{g.show()}});function d(){var e=c(".layout-grid-panel"),f=0;e.each(function(j,i){var g=c(i),h=g.find(".layout-structure"),k=g.find(".row"),l=[];k.each(function(o,n){var q=c(n),p=q.children().not(".column-merge"),m=[];f+=1;p.each(function(s,t){span=c(t).attr("class").split("-");m.push(span[2]);var r=c(t).find(".field-location");if(r.length){r.each(function(u,v){var w=c(v);w.val(f+":"+(s+1)).removeAttr("disabled")})}});l.push(m.join(":"))});h.val(l.join("|"))})}function a(f,i,h){var e="fld_"+Math.round(Math.random()*10000000),g=e,m=c("#field_config_panels"),j,l;if(h){var k=c("#"+h).clone().wrap("<div>").parent().html().replace(new RegExp(h,"g"),"{{id}}");j=Handlebars.compile(k)}else{j=Handlebars.compile(c("#caldera_field_config_wrapper_templ").html())}l={id:g,label:"",slug:""};m.append(j(l));f.removeClass("button-small").removeClass("button").removeClass("button-primary").removeClass("ui-draggable").removeClass("layout-new-form-field").addClass("layout-form-field").attr("data-config",e);f.find(".layout_field_name").remove();f.find(".field-location").prop("name","config[layout_grid][fields]["+e+"]");f.find(".settings-panel").show();f.appendTo(i);b();f.find(".icon-edit").trigger("click");c("#"+e+"_lable").focus().select();if(h){m.find(".field_config_string").val("");m.find(".field-label").trigger("change")}rebuild_field_binding();baldrickTriggers();c("#"+e).trigger("field.drop");c(document).trigger("field.added")}function b(){c(".toggle-options").sortable({handle:".dashicons-sort",});c("#grid-pages-panel").sortable({placeholder:"row-drop-helper",handle:".sort-handle",items:".first-row-level",axis:"y",stop:function(){d()}});c(".layout-column").sortable({connectWith:".layout-column",appendTo:"#grid-pages-panel",helper:"clone",items:".layout-form-field",handle:".drag-handle",cursor:"move",opacity:0.7,cursorAt:{left:100,top:15},start:function(g,f){f.helper.css({width:"200px",height:"35px",paddingTop:"20px"})},stop:function(g,f){f.item.removeAttr("style");d()}});c("h3 .layout-new-form-field").draggable({helper:"clone",appendTo:"body"});c(".page-toggle.button").droppable({accept:".layout-form-field",over:function(g,f){c(this).trigger("click");c(".layout-column").sortable("refresh")}});c(".layout-column").droppable({greedy:true,activeClass:"ui-state-dropper",hoverClass:"ui-state-hoverable",accept:".layout-new-form-field",drop:function(f,g){var e=g.draggable.clone(),h=c(this);a(e,h)}});d()}b();c("#grid-pages-panel").on("click",".column-fieldinsert .dashicons-plus-alt",function(h){var g=c(this).closest(".column-container"),f=c("#newfield-tool").clone();a(f,g)});c("#grid-pages-panel").on("click",".column-fieldinsert .dashicons-admin-generic",function(f){});c("#grid-pages-panel").on("click",".column-split",function(k){var i=c(this).parent().parent(),h=i.attr("class").split("-"),f=c("<div>").insertAfter(i);var j=Math.ceil(h[2]/2),g=Math.floor(h[2]/2);h[2]=j;i.attr("class",h.join("-"));h[2]=g;f.addClass(h.join("-")).append('<div class="layout-column column-container">');c(this).remove();b();jQuery(".column-tools").remove();jQuery(".column-merge").remove()});c("#grid-pages-panel").on("click",".column-remove",function(h){var i=c(this).closest(".row"),f=i.find(".layout-form-field"),g=i.closest(".layout-grid-panel");if(f.length){if(!confirm(c("#row-remove-fields-message").text())){return}f.each(function(j,e){var l=c(e).data("config");c("#"+l).remove();c('option[value="'+l+'"]').remove();c('[data-bind="'+l+'"]').remove();delete current_form_fields[l]})}i.slideUp(200,function(){c(this).remove();d();rebuild_field_binding();if(!g.find(".row").length){g.remove();var e=c("#page-toggles .button-primary"),k=e.prev(),j=e.next();e.remove();if(k.length){k.trigger("click")}else{j.trigger("click")}}c(document).trigger("remove.page")});jQuery(".column-tools").remove();jQuery(".column-merge").remove()});c(".caldera-config-editor-main-panel").on("click",".caldera-add-row",function(h){h.preventDefault();var g=c(".page-active");if(!g.length){c(".caldera-add-page").trigger("click");return}var f=c('<div style="display:none;" class="first-row-level row"><div class="col-xs-12"><div class="layout-column column-container"></div></div></div>');c(".page-active").append(f);f.slideDown(200);b();d()});c("#grid-pages-panel").on("click",".column-join",function(j){var g=c(this).parent().parent().parent();var h=g.prev(),i=h.attr("class").split("-"),f=g.attr("class").split("-");i[2]=parseFloat(i[2])+parseFloat(f[2]);g.find(".layout-column").contents().appendTo(h.find(".layout-column"));h.attr("class",i.join("-"));g.remove();d();jQuery(".column-tools").remove();jQuery(".column-merge").remove()});c("#grid-pages-panel").on("mouseenter",".row",function(g){var f=jQuery(this);jQuery(".column-tools,.column-merge").remove();f.children().children().first().append('<div class="column-remove column-tools"><i class="icon-remove"></i></div>');f.children().children().last().append('<div class="column-sort column-tools" style="text-align:right;"><i class="dashicons dashicons-menu drag-handle sort-handle"></i></div>');f.children().children().not(":first").prepend('<div class="column-merge"><div class="column-join column-tools"><i class="icon-join"></i></div></div>');var h=f.parent().parent().parent().width()/12-1;f.children().children().each(function(i,e){var l=c(e);var j=l.width()/2-5;l.prepend('<div class="column-fieldinsert column-tools"><i class="dashicons dashicons-plus-alt"></i></div>');if(!l.parent().hasClass("col-xs-1")){l.prepend('<div class="column-split column-tools"><i class="dashicons dashicons-leftright"></i></div>');l.find(".column-split").css("left",j)}});jQuery(".column-merge").draggable({axis:"x",helper:"clone",appendTo:f,grid:[h,0],drag:function(n,o){c(this).addClass("dragging");c(".column-tools").remove();c(".column-split").remove();var m=c(this).parent().parent(),p=o.helper,q=(o.originalPosition.left>p.position().left)?"left":"right",j=0,l=m.prev(),s=Math.round(m.parent().width()/12-10),i=Math.abs(o.originalPosition.left-p.position().left);m.parent().addClass("sizing");if(i>=s){var k=l.attr("class").split("-"),r=m.attr("class").split("-");k[2]=parseFloat(k[2]);r[2]=parseFloat(r[2]);if(q==="left"){k[2]--;r[2]++;if(k[2]>0&&k[2]<(k[2]+r[2])){l.attr("class",k.join("-"));m.attr("class",r.join("-"));o.originalPosition.left=p.position().left}else{c(this).draggable("option","disabled",true)}}else{k[2]++;r[2]--;if(r[2]>0&&r[2]<(r[2]+r[2])){l.attr("class",k.join("-"));m.attr("class",r.join("-"));o.originalPosition.left=p.position().left}else{c(this).draggable("option","disabled",true)}}d()}},stop:function(){c(this).removeClass("dragging").parent().parent().parent().removeClass("sizing")}})});c("#grid-pages-panel").on("mouseleave",".row",function(f){jQuery(".column-tools").remove();jQuery(".column-merge").remove()});c("#grid-pages-panel").on("click",".layout-form-field .icon-remove",function(){var g=c(this),e=g.parent(),f=c("#"+e.data("config"));e.slideUp(100,function(){c(this).remove()});f.slideUp(100,function(){c(this).remove()})});c("#grid-pages-panel").on("click",".layout-form-field .icon-edit",function(){var f=c(this),e=f.parent(),g=c("#"+e.data("config")+"_type").val();c(".caldera-editor-field-config-wrapper").hide();if(e.hasClass("field-edit-open")){e.removeClass("field-edit-open")}else{c(".layout-form-field").removeClass("field-edit-open");e.addClass("field-edit-open");c("#"+e.data("config")).show()}c(document).trigger("show."+e.data("config"));c(document).trigger("show.fieldedit");if(g==="radio"||g==="checkbox"||g==="dropdown"||g==="toggle_switch"){c("#"+e.data("config")+"_auto").trigger("change")}});c("body").on("click",".layout-modal-edit-closer,.layout-modal-save-action",function(i){i.preventDefault();var g=c(this),f=c(".layout-form-field.edit-open"),h=g.closest(".layout-modal-container");settings=h.find(".settings-panel").first();c(".edit-open").removeClass("edit-open");settings.appendTo(f.find(".settings-wrapper")).hide();h.hide()});c(".layout-editor-body").on("change",".layout-core-pod-query",function(){c(this).parent().find(".settings-panel-row").remove();c(".edit-open").find(".drag-handle .set-pod").html(" - "+c(this).val())});c(".layout-editor-body").on("click",".remove-where",function(){c(this).closest(".settings-panel-row").remove()});c(".layout-editor-body").on("click",".use-pod-container",function(){var g=c(this),i=g.prev(),f=i.val(),e="";if(!f.length){return}c(".edit-open").find(".drag-handle .set-pod").html(" - "+i.val());g.parent().parent().find(".spinner").css("display","inline-block");var h={action:"pq_loadpod",pod_reference:{pod:f}};c.post(ajaxurl,h,function(m){g.parent().find(".spinner").css("display","none");var n=c("#where-line-tmpl").html(),j="",k=g.closest(".settings-panel").data("container");for(var l in m){j+='<option value="'+m[l]+'">'+m[l]+"</option>"}n=n.replace(/{{fields}}/g,j).replace(/{{container_id}}/g,k);g.parent().append(n)})});c(".caldera-editor-header").on("click",".column-sort .icon-edit",function(f){});c(".layout-editor-body").on("tray_loaded",".layout-template-tray",function(){b()});c(".caldera-editor-header").on("click",".caldera-editor-header-nav a",function(g){g.preventDefault();var f=c(this);c(".caldera-editor-header-nav li").removeClass("active");c(".caldera-editor-body").hide();c(f.attr("href")).show();f.parent().addClass("active");rebind_field_bindings()});c("body").on("change",".required",function(){check_required_bindings(this)});c("body").on("submit",".caldera-forms-options-form",function(f){var g=c(".required.has-error");if(g.length){f.preventDefault()}});c(".caldera-editor-body").on("click",".add-toggle-option",function(l){var n=c(this);if(n.data("bulk")){c(n.data("bulk")).toggle();c(n.data("bulk")).find("textarea").focus();return}var f=n.closest(".caldera-editor-field-config-wrapper"),k=f.find(".toggle-options"),q=c("#field-option-row-tmpl").html(),o=Handlebars.compile(q),p="opt"+parseInt((Math.random()+1)*1048576),g={_name:"config[fields]["+f.prop("id")+"][config]",option:{}};if(n.data("options")){var m=c(n.data("options")),j=m.val().split("\n");for(var h=0;h<j.length;h++){g.option["opt"+parseInt((Math.random()+h)*1048576)]={value:j[h],label:j[h],"default":false}}c(n.data("options")).parent().hide();m.val("");k.empty()}else{g.option[p]={value:"",label:"","default":false}}k.append(o(g));f.find(".toggle_show_values").trigger("change");c(".toggle-options").sortable({handle:".dashicons-sort"});if(!j){k.find(".toggle_label_field").last().focus()}});c(".caldera-editor-body").on("click",".toggle-remove-option",function(g){var f=c(this).closest(".caldera-editor-field-config-wrapper").find(".field-config").first();c(this).parent().remove();f.trigger("change")});c(".caldera-editor-body").on("click",".page-toggle",function(i){var f=c(this),g=f.parent(),h=g.find(".button");h.removeClass("button-primary");c(".layout-grid-panel").hide().removeClass("page-active");c("#"+f.data("page")).show().addClass("page-active");f.addClass("button-primary");h.each(function(j,e){c(e).html(g.data("title")+" "+(j+1))});if(h.length===1){g.hide()}});c(".caldera-editor-body").on("blur toggle.values",".toggle_label_field",function(h){var f=c(this),g=f.prev();if(g.val().length){return}g.val(f.val())});rebuild_field_binding();c(document).trigger("load.page")});Handlebars.registerHelper("_options_config",function(){});jQuery(document).ready(function(a){function c(){a(".caldera-editor-processors-panel ul").sortable({update:function(){rebuild_field_binding()}})}a("body").on("click",".caldera-processor-nav a",function(f){f.preventDefault();var d=a(this);a(".caldera-processor-nav").removeClass("active");a(".caldera-editor-processor-config-wrapper").hide();a(d.attr("href")).show();d.parent().addClass("active")});a("body").on("click",".add-new-processor",function(g){var f=a(this),d=Handlebars.compile(a("#processor-wrapper-tmpl").html());wrap=a(".active-processors-list"),process_conf=a(".caldera-editor-processor-config"),processid=Math.round(Math.random()*100000000);new_templ=Handlebars.compile(a("#processor-line-tmpl").html());new_proc={id:"fp_"+processid,type:f.data("type")};wrap.append(new_templ(new_proc));process_conf.append(d(new_proc));a("#form_processor_baldrickModalCloser").trigger("click");a(".caldera-processor-nav a").last().trigger("click");a("#fp_"+processid+"_type").val(f.data("type")).trigger("change");c();baldrickTriggers()});a("body").on("click",".delete-processor",function(h){var d=a(this),g=d.closest(".caldera-editor-processor-config-wrapper"),f=g.data("type");if(!confirm(d.data("confirm"))){return}a("."+g.prop("id")).remove();g.remove();a(".caldera-processor-nav a").first().trigger("click");rebuild_field_binding()});a("body").on("change",".caldera-select-processor-type",function(h){var f=a(this),d=f.closest(".caldera-editor-processor-config-wrapper"),j=f.find('option[value="'+f.val()+'"]').text(),i=d.find(".caldera-editor-processor-title"),g=a(".caldera-processor-nav.active a");if(j===""){j=i.data("title")}i.html(j);g.html(j+' <span class="processor-line-number"></span>').parent().addClass("processor_type_"+f.val());b(this);rebuild_field_binding()});function b(h){var d=a(h),j=a("#"+d.val()+"-tmpl").length?a("#"+d.val()+"-tmpl").html():"",g=d.closest(".caldera-editor-processor-config-wrapper"),k=g.find(".caldera-config-processor-setup"),f=Handlebars.compile(j),e=g.find(".processor_config_string").val(),i=d.data("type");if(e.length&&i===d.val()){e=JSON.parse(e)}else{e=processor_defaults[d.val()+"_cfg"]}if(!e){e={}}e._id=g.prop("id");e._name="config[processors]["+g.prop("id")+"][config]";f=a("<div>").html(f(e));k.html(f.html());if(typeof window[d.val()+"_init"]==="function"){window[d.val()+"_init"](g.prop("id"),k)}if(g.find(".no-conditions").length){g.find(".toggle_option_tab").remove()}rebuild_field_binding();baldrickTriggers();a(".wp-baldrick").baldrick({request:ajaxurl,method:"POST",before:function(l){var m=a(l);if(m.data("addNode")&&!m.data("request")){m.data("request","cf_get_default_setting")}}})}rebuild_field_binding();a(".caldera-select-processor-type").each(function(e,d){b(d)});c()});Handlebars.registerHelper("_field",function(c){var b=this,h="",d="",a="";var f=this[c.hash.slug]?' data-default="'+this[c.hash.slug]+'"':"";if(c.hash.required){h=" required"}if(c.hash.exclude){a='data-exclude="'+c.hash.exclude+'"'}if(c.hash.array){d="[]";if(c.hash.array!=="true"){f='value="'+c.hash.array+'"'}}out="<select "+(c.hash.type?'data-type="'+c.hash.type+'"':"")+f+" "+a+' name="'+this._name+"["+c.hash.slug+"]"+d+'" id="'+this._id+"_"+c.hash.slug+'" class="block-input field-config caldera-field-bind'+h+'">';if(this[c.hash.slug]){out+='<option class="bound-field" value="'+this[c.hash.slug]+'" class="bound-field"></option>'}else{if(!c.hash.required){out+='<option value=""></option>'}}for(var g in current_form_fields){var e="";if(c.hash.type){if(current_form_fields[g].type!==c.hash.type){continue}}if(b[c.hash.slug]){if(b[c.hash.slug]===g){e=' selected="selected"'}}out+='<option value="'+g+'"'+e+">"+current_form_fields[g].label+" ["+current_form_fields[g].slug+"]</option>"}out+="</select>";if(c.hash.required){out+='<input class="field-config" name="'+this._name+'[_required_bounds][]" type="hidden" value="'+c.hash.slug+'">'}return out});Handlebars.registerHelper("console",function(b,a){console.log(this)});